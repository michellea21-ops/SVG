<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Level 3 - Kitchen | Hokkien Learning</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        
        #gameCanvas {
            display: block;
            margin: 0 auto;
            cursor: crosshair;
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        
        /* Next level button */
        .next-button {
            position: absolute;
            top: 20px;
            left: 200px;
            z-index: 20;
            background: rgba(0, 150, 255, 0.9);
            color: white;
            border: 2px solid #333;
            border-radius: 15px;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            display: none;
        }
        
        .next-button:hover {
            background: rgba(0, 150, 255, 1);
            transform: scale(1.05);
        }
        
        /* Score display */
        .score-display {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 20;
            background: rgba(0, 150, 0, 0.8);
            color: white;
            border-radius: 15px;
            padding: 10px 20px;
            font-size: 16px;
            font-weight: bold;
        }
        
        /* Object info popup */
        .object-info {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: bold;
            pointer-events: none;
            z-index: 30;
            display: none;
        }
        
        /* Hint button */
        .hint-button {
            position: absolute;
            top: 20px;
            right: 200px;
            z-index: 20;
            background: rgba(255, 165, 0, 0.9);
            color: white;
            border: 2px solid #333;
            border-radius: 15px;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .hint-button:hover {
            background: rgba(255, 165, 0, 1);
            transform: scale(1.05);
        }
        
        /* Hint overlay */
        .hint-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            z-index: 40;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 18px;
            text-align: center;
        }
        
        .hint-content {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            margin: 20px;
        }
        
        .hint-close {
            position: absolute;
            top: 20px;
            right: 30px;
            font-size: 30px;
            cursor: pointer;
            color: #fff;
        }
    </style>
</head>
<body>
    
    <!-- Next level button -->
    <div class="next-button" id="nextButton" onclick="goToNextLevel()">Next Level ‚Üí</div>
    
    <!-- Hint button -->
    <div class="hint-button" onclick="showHint()">üí° Hint</div>
    
    <!-- Score display -->
    <div class="score-display" id="score">Score: 0/12</div>
    
    <!-- Object info popup -->
    <div class="object-info" id="objectInfo"></div>
    
    <!-- Hint overlay -->
    <div class="hint-overlay" id="hintOverlay">
        <span class="hint-close" onclick="hideHint()">&times;</span>
        <div class="hint-content">
            <h3>üç≥ Kitchen Hints</h3>
            <p><strong>Look for these cooking items:</strong></p>
            <ul style="text-align: left;">
                <li>‚ùÑÔ∏è <strong>Refrigerator</strong> - Large white appliance on the left</li>
                <li>ü•Ñ <strong>Ladle</strong> - Long-handled spoon for serving</li>
                <li>üç≥ <strong>Spatula</strong> - Flat cooking utensil for flipping</li>
                <li>üî™ <strong>Knife</strong> - Sharp cutting tool</li>
                <li>üè† <strong>Counter</strong> - Work surface in the middle</li>
                <li>üî• <strong>Stove</strong> - Cooking surface with burners</li>
                <li>üç≤ <strong>Pot</strong> - Deep cooking vessel</li>
                <li>üç≥ <strong>Pan</strong> - Flat cooking vessel</li>
                <li>üì° <strong>Microwave</strong> - Electric heating appliance</li>
                <li>üçû <strong>Toaster</strong> - Bread browning appliance</li>
                <li>üóëÔ∏è <strong>Trash Can</strong> - Waste container</li>
                <li>üß§ <strong>Oven Mitt</strong> - Heat protection glove</li>
            </ul>
            <p><em>Tip: Look for small utensils hanging on the wall!</em></p>
        </div>
    </div>
    
    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let backgroundImage = new Image();
        let isImageLoaded = false;
        let score = 0;
        let totalObjects = 12;
        let foundObjects = new Set();
        
        // X button position (top-right corner of the image)
        const closeButton = { x: 0.92, y: 0.02, width: 0.06, height: 0.08 };
        
        // Object positions for kitchen scene (coordinates based on 3.jpg layout)
        const objects = {
            fridge: { 
                x: 0.08, y: 0.18, width: 0.18, height: 0.68,
                hokkien: "ÂÜ∞ÁÆ± (peng-siu‚Åø)",
                english: "Refrigerator",
                indonesian: "Kulkas",
                svg: "Fridge.svg"
            },
            ladle: { 
                x: 0.28, y: 0.25, width: 0.04, height: 0.12,
                hokkien: "Êùì‰ªî (siaÃçh-√°)",
                english: "Ladle",
                indonesian: "Sendok Sayur",
                svg: "Ladle.svg"
            },
            spatula: { 
                x: 0.32, y: 0.25, width: 0.04, height: 0.12,
                hokkien: "Èèü‰ªî (chh√†n-√°)",
                english: "Spatula",
                indonesian: "Spatula",
                svg: "Spatula.svg"
            },
            knife: { 
                x: 0.36, y: 0.25, width: 0.04, height: 0.12,
                hokkien: "ÂàÄ‰ªî (to-√°)",
                english: "Knife",
                indonesian: "Pisau",
                svg: "Knife.svg"
            },
            counter: { 
                x: 0.26, y: 0.38, width: 0.48, height: 0.48,
                hokkien: "ÊµÅÁêÜÂè∞ (li√ª-l√≠-t√¢i)",
                english: "Counter",
                indonesian: "Meja Dapur",
                svg: "Counter.svg"
            },
            stove: { 
                x: 0.42, y: 0.42, width: 0.12, height: 0.08,
                hokkien: "Áàê‰ªî (l√¥Õò-√°)",
                english: "Stove",
                indonesian: "Kompor",
                svg: "Stove.svg"
            },
            pot: { 
                x: 0.44, y: 0.38, width: 0.08, height: 0.06,
                hokkien: "Èºé (ti√°‚Åø)",
                english: "Pot",
                indonesian: "Panci",
                svg: "Pot.svg"
            },
            pan: { 
                x: 0.48, y: 0.42, width: 0.06, height: 0.04,
                hokkien: "Âπ≥Â∫ïÈçã (p√™‚Åø-t√©-ko)",
                english: "Pan",
                indonesian: "Wajan",
                svg: "Pan.svg"
            },
            microwave: { 
                x: 0.58, y: 0.32, width: 0.12, height: 0.08,
                hokkien: "ÂæÆÊ≥¢Áàê (b√Æ-pho-l√¥Õò)",
                english: "Microwave",
                indonesian: "Microwave",
                svg: "Microwave.svg"
            },
            toaster: { 
                x: 0.76, y: 0.42, width: 0.08, height: 0.08,
                hokkien: "ÁÉ§È∫µÂåÖÊ©ü (k«éu-mƒ´-pau-ki)",
                english: "Toaster",
                indonesian: "Pemanggang Roti",
                svg: "Toaster.svg"
            },
            trash: { 
                x: 0.82, y: 0.68, width: 0.12, height: 0.18,
                hokkien: "ÂûÉÂúæÊ°∂ (lah-sap-th√°ng)",
                english: "Trash Can",
                indonesian: "Tempat Sampah",
                svg: "Trash.svg"
            },
            oven_mitt: { 
                x: 0.65, y: 0.52, width: 0.06, height: 0.08,
                hokkien: "ÈöîÁÜ±ÊâãÂ•ó (keh-jiaÃçt-chhi√∫-thoÃçh)",
                english: "Oven Mitt",
                indonesian: "Sarung Tangan Oven",
                svg: "Oven Mitt.svg"
            }
        };

        function resizeCanvas() {
            const container = canvas.parentElement;
            const containerWidth = container.clientWidth;
            const containerHeight = container.clientHeight;
            
            canvas.width = containerWidth;
            canvas.height = containerHeight;
            
            if (isImageLoaded) {
                drawGame();
            }
        }

        function drawGame() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw background image (3.jpg)
            const aspectRatio = backgroundImage.width / backgroundImage.height;
            let drawWidth, drawHeight, drawX, drawY;
            
            if (canvas.width / canvas.height > aspectRatio) {
                drawHeight = canvas.height;
                drawWidth = drawHeight * aspectRatio;
                drawX = (canvas.width - drawWidth) / 2;
                drawY = 0;
            } else {
                drawWidth = canvas.width;
                drawHeight = drawWidth / aspectRatio;
                drawX = 0;
                drawY = (canvas.height - drawHeight) / 2;
            }
            
            ctx.drawImage(backgroundImage, drawX, drawY, drawWidth, drawHeight);
            
            // Cover the duplicate X button (left one at ~85-88% position)
            const duplicateXButton = { x: 0.85, y: 0.02, width: 0.06, height: 0.08 };
            const coverX = drawX + (drawWidth * duplicateXButton.x);
            const coverY = drawY + (drawHeight * duplicateXButton.y);
            const coverWidth = drawWidth * duplicateXButton.width;
            const coverHeight = drawHeight * duplicateXButton.height;
            
            // Use the background color to cover the duplicate button (beige color from kitchen scene)
            ctx.fillStyle = '#b5a592'; // Beige/brown background color from the kitchen image
            ctx.fillRect(coverX, coverY, coverWidth, coverHeight);
            
            // Draw found object indicators
            ctx.strokeStyle = '#00ff00';
            ctx.lineWidth = 3;
            foundObjects.forEach(objectName => {
                const obj = objects[objectName];
                if (obj) {
                    const objX = drawX + (drawWidth * obj.x);
                    const objY = drawY + (drawHeight * obj.y);
                    const objWidth = drawWidth * obj.width;
                    const objHeight = drawHeight * obj.height;
                    
                    ctx.strokeRect(objX, objY, objWidth, objHeight);
                    
                    // Add checkmark
                    ctx.fillStyle = '#00ff00';
                    ctx.font = 'bold 20px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('‚úì', objX + objWidth/2, objY - 10);
                }
            });
        }

        function getClickedObject(x, y) {
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            
            const canvasX = (x - rect.left) * scaleX;
            const canvasY = (y - rect.top) * scaleY;
            
            // Calculate drawing dimensions to match drawGame function
            const aspectRatio = backgroundImage.width / backgroundImage.height;
            let drawWidth, drawHeight, drawX, drawY;
            
            if (canvas.width / canvas.height > aspectRatio) {
                drawHeight = canvas.height;
                drawWidth = drawHeight * aspectRatio;
                drawX = (canvas.width - drawWidth) / 2;
                drawY = 0;
            } else {
                drawWidth = canvas.width;
                drawHeight = drawWidth / aspectRatio;
                drawX = 0;
                drawY = (canvas.height - drawHeight) / 2;
            }
            
            // Convert to relative coordinates within the actual image bounds
            const relX = (canvasX - drawX) / drawWidth;
            const relY = (canvasY - drawY) / drawHeight;
            
            // Check if click is within image bounds
            if (relX < 0 || relX > 1 || relY < 0 || relY > 1) {
                return null;
            }
            
            // Check if close button was clicked first
            if (relX >= closeButton.x && relX <= closeButton.x + closeButton.width &&
                relY >= closeButton.y && relY <= closeButton.y + closeButton.height) {
                return 'close';
            }
            
            // Check which object was clicked (smallest objects first to avoid overlap issues)
            const objectEntries = Object.entries(objects).sort((a, b) => {
                const areaA = a[1].width * a[1].height;
                const areaB = b[1].width * b[1].height;
                return areaA - areaB;
            });
            
            for (const [objectName, obj] of objectEntries) {
                if (relX >= obj.x && relX <= obj.x + obj.width &&
                    relY >= obj.y && relY <= obj.y + obj.height) {
                    return objectName;
                }
            }
            return null;
        }

        function showObjectInfo(objectName, x, y) {
            const obj = objects[objectName];
            if (!obj) return;
            
            const infoDiv = document.getElementById('objectInfo');
            infoDiv.innerHTML = `
                <div><strong>Hokkien:</strong> ${obj.hokkien}</div>
                <div><strong>English:</strong> ${obj.english}</div>
                <div><strong>Indonesian:</strong> ${obj.indonesian}</div>
            `;
            
            infoDiv.style.left = (x + 10) + 'px';
            infoDiv.style.top = (y - 10) + 'px';
            infoDiv.style.display = 'block';
            
            // Hide after 3 seconds
            setTimeout(() => {
                infoDiv.style.display = 'none';
            }, 3000);
        }

        function updateScore() {
            document.getElementById('score').textContent = `Score: ${score}/${totalObjects}`;
            
            if (score === totalObjects) {
                // Show next level button
                document.getElementById('nextButton').style.display = 'block';
                setTimeout(() => {
                    alert('üéâ Kitchen completed! Moving to Study Room...\\nÂªöÊàøÂÆåÊàêÔºÅÁßªÂãïÂà∞Êõ∏Êàø...\\nDapur selesai! Pindah ke Ruang Belajar...');
                }, 500);
            }
        }

        function goBack() {
            window.location.href = 'game-level-2.html';
        }

        function goToNextLevel() {
            window.location.href = 'game-level-4.html';
        }
        
        function showHint() {
            document.getElementById('hintOverlay').style.display = 'flex';
        }
        
        function hideHint() {
            document.getElementById('hintOverlay').style.display = 'none';
        }

        // Event listeners
        canvas.addEventListener('click', function(event) {
            const clickedObject = getClickedObject(event.clientX, event.clientY);
            
            if (clickedObject === 'close') {
                goBack();
            } else if (clickedObject && !foundObjects.has(clickedObject)) {
                foundObjects.add(clickedObject);
                score++;
                updateScore();
                drawGame();
                showObjectInfo(clickedObject, event.clientX, event.clientY);
                
                // Play success sound (if available)
                console.log(`Found: ${clickedObject}`);
            }
        });

        // Hover effect for cursor
        canvas.addEventListener('mousemove', function(event) {
            const hoveredObject = getClickedObject(event.clientX, event.clientY);
            
            if (hoveredObject === 'close') {
                canvas.style.cursor = 'pointer';
            } else if (hoveredObject && !foundObjects.has(hoveredObject)) {
                canvas.style.cursor = 'pointer';
            } else {
                canvas.style.cursor = 'crosshair';
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                // First check if hint is open, close it; otherwise go back
                const hintOverlay = document.getElementById('hintOverlay');
                if (hintOverlay.style.display === 'flex') {
                    hideHint();
                } else {
                    goBack();
                }
            } else if (event.key === 'r' || event.key === 'R') {
                // Reset game
                foundObjects.clear();
                score = 0;
                updateScore();
                document.getElementById('nextButton').style.display = 'none';
                drawGame();
            } else if (event.key === 'n' || event.key === 'N') {
                if (score === totalObjects) {
                    goToNextLevel();
                }
            } else if (event.key === 'h' || event.key === 'H') {
                // Show hint with 'H' key
                showHint();
            }
        });

        // Window resize handler
        window.addEventListener('resize', resizeCanvas);

        // Initialize
        backgroundImage.onload = function() {
            isImageLoaded = true;
            resizeCanvas();
        };
        
        backgroundImage.src = '3/3.jpg';
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            resizeCanvas();
            updateScore();
        });
    </script>
</body>
</html>